<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RISC-V Capacity and Bandwidth QoS Register Interface :: RISC-V Ratified Specifications Library</title>
    <meta name="description" content="RISC-V Capacity and Bandwidth Controller QoS Register Interface">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="3f4ce2c51445edcfc62ee1f59ab97fffc218fb79"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="qos">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">RISC-V Ratified Specifications Library</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="qos" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">RISC-V Capacity and Bandwidth QoS Register Interface</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V Capacity and Bandwidth Controller QoS Register Interface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_identifiers.html">QoS Identifiers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_capacity.html">Capacity-controller QoS Register Interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_bandwidth.html">Bandwidth-controller QoS Register Interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_iommu.html">IOMMU Extension for QoS ID</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_hw_guidelines.html">Hardware Guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_sw_guidelines.html">Software Guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="https://github.com/riscv-non-isa/riscv-cbqri/releases/download/v1.0/riscv-cbqri.pdf">Download PDF</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="RISC-V Capacity and Bandwidth QoS Register Interface"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv-non-isa/riscv-cbqri/edit/antora-refactor/modules/ROOT/pages/qos_header.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv-non-isa/riscv-cbqri" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      <a href="" title="PDF">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Download PDF
        </a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="qos_header.html">RISC-V Capacity and Bandwidth QoS Register Interface</a></li>
    </ul>
  </nav>
</div><h1 id="page-title" class="page">RISC-V Capacity and Bandwidth QoS Register Interface</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#copyright-and-license-information">Copyright and license information</a></li>
<li><a href="#contributors">Contributors</a></li>
<li><a href="#intro">1. Introduction</a></li>
<li><a href="#QOS_ID">2. QoS Identifiers</a>
<ul class="sectlevel2">
<li><a href="#EMCID">2.1. Associating <code>RCID</code> and <code>MCID</code> with requests</a>
<ul class="sectlevel3">
<li><a href="#risc-v-hart-initiated-requests-ssqosid">2.1.1. RISC-V hart initiated requests (Ssqosid)</a></li>
<li><a href="#device-initiated-requests">2.1.2. Device initiated requests</a></li>
</ul>
</li>
<li><a href="#access-type-at">2.2. Access type (<code>AT</code>)</a></li>
</ul>
</li>
<li><a href="#CC_QOS">3. Capacity-controller QoS Register Interface</a>
<ul class="sectlevel2">
<li><a href="#CC_CAP">3.1. Capacity-controller Capabilities</a></li>
<li><a href="#CC_MCTL">3.2. Capacity Usage Monitoring Control</a></li>
<li><a href="#CC_MCTR">3.3. Capacity Usage Monitoring Counter Value</a></li>
<li><a href="#CC_ALLOC">3.4. Capacity Allocation Control</a></li>
<li><a href="#CC_BMASK">3.5. Capacity Block Mask (<code>cc_block_mask</code>)</a></li>
<li><a href="#CC_CUNITS">3.6. Capacity Units</a></li>
</ul>
</li>
<li><a href="#BC_QOS">4. Bandwidth-controller QoS Register Interface</a>
<ul class="sectlevel2">
<li><a href="#BC_CAP">4.1. Bandwidth-controller Capabilities</a></li>
<li><a href="#BC_MCTL">4.2. Bandwidth Usage Monitoring Control</a></li>
<li><a href="#BC_MCTR">4.3. Bandwidth Monitoring Counter Value</a></li>
<li><a href="#BC_ALLOC">4.4. Bandwidth Allocation Control</a></li>
<li><a href="#BC_BMASK">4.5. Bandwidth Allocation Configuration</a></li>
</ul>
</li>
<li><a href="#QOS_IOMMU">5. IOMMU Extension for QoS ID</a>
<ul class="sectlevel2">
<li><a href="#iommu-registers">5.1. IOMMU Registers</a>
<ul class="sectlevel3">
<li><a href="#reset-behavior">5.1.1. Reset Behavior</a></li>
<li><a href="#iommu-capabilities">5.1.2. IOMMU Capabilities</a></li>
<li><a href="#iommu-qos-id">5.1.3. IOMMU QoS ID</a></li>
</ul>
</li>
<li><a href="#device-context-fields">5.2. Device-context Fields</a></li>
<li><a href="#iommu-atc-capacity-allocation-and-monitoring">5.3. IOMMU ATC Capacity Allocation and Monitoring</a></li>
</ul>
</li>
<li><a href="#QOS_HW_GUIDE">6. Hardware Guidelines</a>
<ul class="sectlevel2">
<li><a href="#QOS_SIZING">6.1. Sizing QoS Identifiers</a></li>
<li><a href="#sizing-monitoring-counters">6.2. Sizing Monitoring Counters</a></li>
</ul>
</li>
<li><a href="#QOS_SW_GUIDE">7. Software Guidelines</a>
<ul class="sectlevel2">
<li><a href="#reporting-capacity-and-bandwidth-controllers">7.1. Reporting Capacity and Bandwidth Controllers</a></li>
<li><a href="#context-switching-qos-identifiers">7.2. Context Switching QoS Identifiers</a></li>
<li><a href="#qos-configurations-for-virtual-machines">7.3. QoS Configurations for Virtual Machines</a></li>
<li><a href="#qos-identifiers-for-supervisor-and-machine-mode">7.4. QoS Identifiers for Supervisor and Machine Mode</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">This document is in the <a href="http://riscv.org/spec-state">Ratified state</a></div>
<div class="paragraph">
<p>No changes are allowed. Any desired or needed changes can be the subject of a
follow-on new extension. Ratified extensions are never revised.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright-and-license-information"><a class="anchor" href="#copyright-and-license-information"></a>Copyright and license information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification is licensed under the Creative Commons
Attribution 4.0 International License (CC-BY 4.0). The full
license text is available at
<a href="https://creativecommons.org/licenses/by/4.0/" class="bare">creativecommons.org/licenses/by/4.0/</a>.</p>
</div>
<div class="paragraph">
<p>Copyright 2024 by RISC-V International.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributors"><a class="anchor" href="#contributors"></a>Contributors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This RISC-V specification has been contributed to directly or indirectly by:</p>
</div>
<div class="paragraph">
<p>Aaron Durbin, Adrien Ricciardi, Allen Baum, Allison Randal, Ambika Krishnamoorthy, Beeman Strong, Daniel Gracia PÃ©rez, Roy Franz, David Kruckemeyer, David Weaver, Derek Hower, Drew Fustini, Eric Shiu, Greg Favor, Perrine Peresse, Ravi Sahita, Ved Shanbhogue</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intro"><a class="anchor" href="#intro"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quality of Service (QoS) is defined as the minimal end-to-end performance that
is guaranteed in advance by a service level agreement (SLA) to a workload. A
workload can be a single application, a group of applications, a virtual machine,
a group of virtual machines, or a combination of those. The performance is measured
in the form of metrics such as instructions per cycle (IPC), latency
of servicing work, etc.</p>
</div>
<div class="paragraph">
<p>Various factors such as the available cache capacity, memory bandwidth,
interconnect bandwidth, CPU cycles, system memory, and so on affect the performance
of a computing system that runs multiple workloads concurrently. Furthermore,
during arbitration for shared resources, the prioritization of the
workloads' requests against other competing requests might also affect the
performance of the workload. Such interference due to resource sharing can lead
to unpredictable workload performance cite:[PTCAMP].</p>
</div>
<div class="paragraph">
<p>When multiple workloads are running concurrently on modern processors with large
core counts, multiple cache hierarchies, and multiple memory controllers, the
performance of a workload can become less deterministic or even non-deterministic.
This situation occurs because the workload performance depends on the behavior of the
other workloads in the machine that contend for the shared resources, which can lead to
interference. In many deployment scenarios, such as public cloud servers, the
workload owner might not be in control of the type and placement of other
workloads in the platform.</p>
</div>
<div class="paragraph">
<p>System software can control some of these resources available to the workload,
such as the number of hardware threads made available for execution, the amount
of system memory allocated to the workload, and the number of CPU cycles provided
for execution.</p>
</div>
<div class="paragraph">
<p>System software needs additional tools to control interference to a workload
and thereby reduce the variability in the performance that is experienced by one workload
due to other workloads' cache capacity usage, memory bandwidth usage,
interconnect bandwidth usage, and so on through a resource allocation capability.
The resource allocation capability enables system software to reserve capacity
and/or bandwidth to meet the performance goals of the workload. Such controls
can improve the utilization of the system by co-locating workloads while
minimizing the interference caused by one workload to another cite:[HERACLES].</p>
</div>
<div class="paragraph">
<p>Effective use of the resource allocation capability requires the hardware to provide
a resource monitoring capability by which the resource requirements of a
workload needed to meet a certain performance goal can be characterized. A
typical use model involves profiling the resource usage of the workload by using
the resource monitoring capability and to establish resource allocations for the
workload by using the resource allocation capability.</p>
</div>
<div class="paragraph">
<p>The allocation might be in the form of capacity or bandwidth, depending on the type
of resource. For caches, TLBs, and directories, the resource allocation is in
the form of storage capacity. For interconnects and memory controllers, the
resource allocation is in the form of bandwidth.</p>
</div>
<div class="paragraph">
<p>Workloads generate different types of accesses to shared resources. For example,
some of the requests might be for accessing instructions and other requests might be
to access data that is operated on by the workload. Certain data accesses might not have
temporal locality, whereas others can have a high probability of reuse. In some
cases, you can provide differentiated treatment to each type of access by providing
unique resource allocation to each access type.</p>
</div>
<div class="paragraph">
<p>RISC-V Capacity and Bandwidth Controller QoS Register Interface (CBQRI)
specification specifies the following identifiers and interfaces:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>QoS identifiers to identify workloads that originate requests to the shared
resources. These QoS identifiers include an identifier for resource allocation
configurations and an identifier for the monitoring counters used to monitor
resource usage. These identifiers accompany each request that is made by the
workload to the shared resource. <a href="#QOS_ID">Chapter 2</a> specifies the mechanism to associate
the identifiers with workloads.</p>
</li>
<li>
<p>Access-type identifiers to accompany request to access a shared resource to
allow differentiated treatment of each access-type (for example, code vs. data,).
The access-types are defined in <a href="#QOS_ID">Chapter 2</a>.</p>
</li>
<li>
<p>Register interface for capacity allocation in controllers, such as shared
caches, directories, and so on. The capacity allocation register interface is
specified in <a href="#CC_QOS">Chapter 3</a>.</p>
</li>
<li>
<p>Register interface for capacity usage monitoring. The capacity usage
monitoring register interface is specified in <a href="#CC_QOS">Chapter 3</a>.</p>
</li>
<li>
<p>Register interface for bandwidth allocation in controllers, such as
interconnect and memory controllers. The bandwidth allocation register
interface is specified in <a href="#BC_QOS">Chapter 4</a>.</p>
</li>
<li>
<p>Register interface for bandwidth usage monitoring. The bandwidth
usage monitoring register interface is specified in <a href="#BC_QOS">Chapter 4</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The capacity and bandwidth controller register interfaces for resource
allocation and usage monitoring are defined as memory-mapped registers. Each
controller that supports CBQRI provides a set of registers that are
memory-mapped, starting at an 8-byte aligned physical address. The memory-mapped
registers can be accessed by using naturally aligned 4-byte or 8-byte memory
accesses. The controller behavior for register accesses where the address is not
aligned to the size of the access, or if the access spans multiple registers, or
if the size of the access is not 4 bytes or 8 bytes, is <code>UNSPECIFIED</code>. A 4-byte
access to a register must be single-copy atomic. Whether an 8-byte access to a
CBQRI register is single-copy atomic is considered <code>UNSPECIFIED</code>. This type of access can
appear, internally to the CBQRI implementation, as if two separate 4-byte
accesses are performed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CBQRI registers are defined so that software can perform two individual 4 byte accesses, or hardware can perform two independent 4 byte transactions resulting from an 8 byte access, to the high and low halves of the register as long as the register semantics, with regards to side-effects, are respected between the two software accesses, or two hardware transactions, respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The controller registers use little-endian byte order (even if all harts are
big-endian-only).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Big-endian-configured harts that make use of the register interface might
implement the <code>REV8</code> byte-reversal instruction defined by the Zbb extension. If
<code>REV8</code> is not implemented, then endianness conversion might be implemented by using a
sequence of instructions.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>A controller can support a subset of capabilities that are defined by CBQRI. When a
capability is not supported, the registers and/or fields used to configure and/or
control such capabilities are hardwired to <code>0</code>. Each controller supports a
capabilities register to enumerate the supported capabilities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QOS_ID"><a class="anchor" href="#QOS_ID"></a>2. QoS Identifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Monitoring or allocation of resources requires a way to identify the originator
of the request to access the resource.</p>
</div>
<div class="paragraph">
<p>CBQRI and the Ssqosid extension provides a mechanism by which a workload can
be associated with a resource control ID (<code>RCID</code>) and a monitoring counter ID
(<code>MCID</code>) that accompany each request made by the workload to shared resources.</p>
</div>
<div class="paragraph">
<p>To provide differentiated services to workloads, CBQRI defines a mechanism to
configure resource usage limits, in the form of capacity or bandwidth,
per supported access type, for an <code>RCID</code> in the resource controllers that
control accesses to such shared resources.</p>
</div>
<div class="paragraph">
<p>To monitor the resource utilization by a workload, CBQRI defines a mechanism to
configure counters identified by the <code>MCID</code> to count events in the resource
controllers that control accesses to such shared resources.</p>
</div>
<div class="paragraph">
<p><a href="#QOS_SIZING">Section 6.1</a> discusses guidelines for sizing the QoS IDs and the need for
differentiated IDs for monitoring. All supported <code>RCID</code> and <code>MCID</code> can be
actively used in the system at any instance.</p>
</div>
<div class="sect2">
<h3 id="EMCID"><a class="anchor" href="#EMCID"></a>2.1. Associating <code>RCID</code> and <code>MCID</code> with requests</h3>
<div class="paragraph">
<p>The <code>RCID</code> in the request is used by the resource controllers to determine the
resource allocations (for example, cache occupancy limits, memory bandwidth limits,
and so on) to enforce.</p>
</div>
<div class="paragraph">
<p>The <code>MCID</code> in the request is used by the resource controllers to identify the ID
of a counter to monitor resource usage (for example, cache occupancy, memory bandwidth,
and so on). Two modes of operation are supported by CBQRI. In the direct mode, the
<code>MCID</code> carried with the request is directly used by the controller to identify
the counter and is the effective <code>MCID</code>. In the RCID-prefixed mode, the
controller identifies the counter for monitoring using an effective <code>MCID</code>
computed as: \(Effective-MCID = (RCID \ll P) \mid (MCID \, \text{&amp;} \, ((1 \ll P) - 1))\).</p>
</div>
<div class="paragraph">
<p>Legal values of <code>P</code> range from 0 to 12 and are enumerated in the capability
register of the controller. Software should use the effective <code>MCID</code> as the
<code>MCID</code> operand to the controller for operations on the monitoring counters.</p>
</div>
<div class="sect3">
<h4 id="risc-v-hart-initiated-requests-ssqosid"><a class="anchor" href="#risc-v-hart-initiated-requests-ssqosid"></a>2.1.1. RISC-V hart initiated requests (Ssqosid)</h4>
<div class="paragraph">
<p>The Ssqosid extension cite:[SSQOSID] introduces a read/write S/HS-mode register
(<code>srmcfg</code>) to configure QoS Identifiers to be used with requests made by the
hart to shared resources. If Smstateen cite:[STATEEN] is implemented then bit 55
of <code>mstateen0</code> controls access to <code>srmcfg</code> from privilege modes less than M.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="device-initiated-requests"><a class="anchor" href="#device-initiated-requests"></a>2.1.2. Device initiated requests</h4>
<div class="paragraph">
<p>A RISC-V IOMMU cite:[IOMMU] extension to support configuring QoS identifiers is
specified in <a href="#QOS_IOMMU">Chapter 5</a>. If the system supports an IOMMU with this extension,
the IOMMU can be configured with the <code>RCID</code> and <code>MCID</code> to associate with requests
from devices and from the IOMMU itself.</p>
</div>
<div class="paragraph">
<p>If the system does not support an IOMMU with this extension, then the
association of <code>RCID</code> and <code>MCID</code> with requests from devices becomes
implementation-defined. Such methods can include, but are not limited to, one of
the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Devices can be configured with an <code>RCID</code> and <code>MCID</code> for requests originating
from the device, provided the device implementation and the bus protocol used
by the device support such capabilities. The method to configure the QoS
identifiers into devices remains <code>UNSPECIFIED</code>.</p>
</li>
<li>
<p>Where the device does not natively support being configured with an <code>RCID</code>
and <code>MCID</code>, the implementation might provide a shim at the device interface. This
shim can be configured with the <code>RCID</code> and <code>MCID</code> to associate with requests
originating from the device. The method to configure such QoS identifiers into
a shim is <code>UNSPECIFIED</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="access-type-at"><a class="anchor" href="#access-type-at"></a>2.2. Access type (<code>AT</code>)</h3>
<div class="paragraph">
<p>In some usages, in addition to providing differentiated service among workloads,
the ability to differentiate between resource usage for accesses made by the
same workload might be required. For example, the capacity allocated in a shared
cache for code storage might be differentiated from the capacity allocated for
data storage and thereby avoid code from being evicted from such shared cache
due to a data access.</p>
</div>
<div class="paragraph">
<p>When differentiation based on access type (for example, code vs. data) is supported the
requests also carry an access-type (<code>AT</code>) indicator. The resource controllers
can be configured with separate capacity and/or bandwidth allocations for each
supported access type. CBQRI defines a 3-bit <code>AT</code> field, encoded as specified in
<a href="#AT_ENC">Table 1</a>, in the register interface to configure differentiated resource
allocation and monitoring for each <code>AT</code>.</p>
</div>
<table id="AT_ENC" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 1. Encodings of <code>AT</code> field</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requests to access data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Code</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requests for code execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For unsupported <code>AT</code> values the resource controller behaves as if <code>AT</code> was 0.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CC_QOS"><a class="anchor" href="#CC_QOS"></a>3. Capacity-controller QoS Register Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controllers, such as cache controllers, that support capacity allocation and
usage monitoring provide a memory-mapped capacity-controller QoS register
interface.</p>
</div>
<div class="paragraph">
<p>The capacity controller allocates capacity in fixed multiples of <em>capacity
units</em>. A group of these <em>capacity units</em> is referred to as a <em>capacity block</em>.
One or more <em>capacity blocks</em> can be allocated to a workload. When a workload
requests capacity allocation, the capacity is allocated by using <em>capacity units</em>
situated within the <em>capacity blocks</em> assigned to the workload. Capacity blocks
can also be shared among one or more workloads. Optionally, the capacity
controller might allow configuration of a limit on the maximum number of <em>capacity
units</em> that can be occupied in the <em>capacity blocks</em> allocated to a specific
workload.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, a cache controller allocates capacity in multiples of cache
blocks. In this context, a cache block serves as a <em>capacity unit</em>, and a group
of cache blocks forms a <em>capacity block</em>. A cache controller supporting capacity
allocation <em>by ways</em> might define a <em>capacity block</em> to be the cache blocks in one
way of the cache.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The capacity allocation affects the decision regarding which <em>capacity blocks</em>
to use when a new <em>capacity unit</em> is requested by a workload, but usually does
not affect other operations of the controller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, when a request is made to a cache controller, the request involves
scanning the entire cache to determine if the requested data is present. If the
data is located, then the request is fulfilled with this data, even if the
cache block containing the data was initially allocated for a different
workload. The data continues to reside in the same cache block. Consequently,
the cache lookup function remains unaffected by the capacity allocation
constraints set for the workload that initiated the request. Conversely, if the data
is not found, a new cache block must be allocated. This allocation is executed
by using the <em>capacity blocks</em> assigned to the workload that made the request.
Hence, a workload might only trigger evictions within <em>capacity blocks</em> designated
to it, but can access shared data in <em>capacity blocks</em> allocated to other
workloads.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="CC_REG" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Capacity-controller QoS Register Layout (size and offset are in bytes)</caption>
<colgroup>
<col style="width: 7.5%;">
<col style="width: 25%;">
<col style="width: 10%;">
<col style="width: 45%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offset</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Optional?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_capabilities</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_CAP">Capabilities </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_mon_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_MCTL">Usage monitoring
                                    control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_mon_ctr_val</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_MCTR">Monitoring
                                    counter value</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_alloc_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_ALLOC">Capacity
                                    allocation control </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_block_mask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BMW</code>/8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_BMASK">Capacity
                                    block mask </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_cunits</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_CUNITS">Capacity units
                                    count</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The size of the <code>cc_block_mask</code> register is determined by the <code>NCBLKS</code> field
of the <code>cc_capabilities</code> register but is always a multiple of 8 bytes. The
formula for determination of <code>BMW</code> is defined in <a href="#CC_BMASK">Section 3.5</a>. The offset <code>N</code> is
determined as <code>32 + BMW/8</code>.</p>
</div>
<div class="paragraph">
<p>The reset value is 0 for the following register fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cc_mon_ctl.BUSY</code> field</p>
</li>
<li>
<p><code>cc_alloc_ctl.BUSY</code> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reset value is <code>UNSPECIFIED</code> for all other registers fields.</p>
</div>
<div class="paragraph">
<p>The capacity controllers at reset must allocate all available capacity to <code>RCID</code>
value of 0. When the capacity controller supports capacity allocation per
access-type, then all available capacity is shared by all the access-type for
<code>RCID=0</code>. The capacity allocation for all other <code>RCID</code> values is <code>UNSPECIFIED</code>.
The capacity controller behavior for handling a request with a non-zero <code>RCID</code>
value before configuring the capacity controller with capacity allocation for
that <code>RCID</code> is <code>UNSPECIFIED</code>.</p>
</div>
<div class="sect2">
<h3 id="CC_CAP"><a class="anchor" href="#CC_CAP"></a>3.1. Capacity-controller Capabilities</h3>
<div class="paragraph">
<p>The <code>cc_capabilities</code> register is a read-only register that holds the
capacity-controller capabilities.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlCw0FHIS8xNtVJQD3MNUq_VQUgZmsGl_JydfLyDUWQVDOGybkHOni64JJ1D_TxDcGoNCnCLQJUzgcsFoEgYG8MlwgOCPEFysToKyfl5aZnpVtU5iXmpQEVAzRnFBYnJqVaGBkYmtbUAANJDOA==" alt="Capacity-controller Capabilities Register">
</div>
<div class="title">Figure 1. Capacity-controller Capabilities Register</div>
</div>
<div class="paragraph">
<p>The <code>VER</code> field holds the version of the specification implemented by the
capacity controller. The low nibble is used to hold the minor version of the
specification and the upper nibble is used to hold the major version of the
specification. For example, an implementation that supports version 1.0 of the
specification reports 0x10.</p>
</div>
<div class="paragraph">
<p>The <code>NCBLKS</code> field holds the total number of allocatable <em>capacity blocks</em> in
the controller. The capacity represented by an allocatable <em>capacity block</em> is
<code>UNSPECIFIED</code>. The capacity controllers support allocating capacity in fixed
multiples of an allocatable <em>capacity block</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, a cache controller that defines a way of the cache as a <em>capacity
block</em> may report the number of ways as the number of allocatable <em>capacity
blocks</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>CUNITS</code> is 1, the controller supports specifying a limit on the <em>capacity
units</em> that can be occupied by an <code>RCID</code> in <em>capacity blocks</em> allocated to it.</p>
</div>
<div class="paragraph">
<p>If <code>FRCID</code> is 1, the controller supports an operation to flush and deallocate
the <em>capacity blocks</em> occupied by an <code>RCID</code>.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>When the <code>RCID</code>-prefixed mode (<code>RPFX</code>) is 1, the controller operates in <code>RPFX</code>
mode. The parameter <code>P</code> (prefixed bits) indicates the number of least significant
bits of the <code>MCID</code> carried in the request that should be prefixed by the RCID. The
controller uses <code>RCID</code> in the requests along with <code>P</code> number of least significant
bits of the <code>MCID</code> to compute an effective <code>MCID</code> (<a href="#EMCID">Section 2.1</a>). This <code>MCID</code> is used
to identify the monitoring counter. Legal values of <code>P</code> range from 0 to 12.</p>
</div>
<div class="paragraph">
<p>If <code>RPFX</code> is 0, <code>P</code> is set to 0, and the effective <code>MCID</code> is the same as the <code>MCID</code>
in the request.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_MCTL"><a class="anchor" href="#CC_MCTL"></a>3.2. Capacity Usage Monitoring Control</h3>
<div class="paragraph">
<p>The <code>cc_mon_ctl</code> register is used to control monitoring of capacity usage by a
<code>MCID</code>. When the controller does not support capacity usage monitoring the
<code>cc_mon_ctl</code> register is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlfJ09XVB1WcDlXMNC4tFlDZHMDMNlXXhAkCeqnDlcLjjEMSQ0GJehTqHBkShyRiYYpsbqKCTn56VlpltV5yTmpYIU6ShkFBckJqdaGRoYmdTWAgBWNFIF" alt="Capacity Usage Monitoring Control Register (`cc_mon_ctl`)">
</div>
<div class="title">Figure 2. Capacity Usage Monitoring Control Register (<code>cc_mon_ctl</code>)</div>
</div>
<div class="paragraph">
<p>Capacity controllers that support capacity usage monitoring implement a usage
monitoring counter for each supported <code>MCID</code>. The usage monitoring counter can
be configured to count a monitoring event. When an event matching the event
configured for the <code>MCID</code> occurs, then the monitoring counter is updated. The
event matching might optionally be filtered by the access-type identifier.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code>, <code>AT</code>, <code>ATV</code>, <code>MCID</code>, and <code>EVT_ID</code> fields of the register are WARL
fields.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code> field is used to instruct the controller to perform an operation listed
in <a href="#CC_MON_OP">Table 3</a>.</p>
</div>
<table id="CC_MON_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Capacity Usage Monitoring Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_EVENT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the counter selected by <code>MCID</code> to count
                             the event selected by <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code>.
                             The <code>EVT_ID</code> encodings are listed in <a href="#CC_EVT_ID">Table 4</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_COUNTER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot the value of the counter selected by
                             <code>MCID</code> into <code>cc_mon_ctr_val</code> register. The
                             <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code> fields are not used by
                             this operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>EVT_ID</code> field is used to program the identifier of the event to count in
the monitoring counter selected by <code>MCID</code>. The <code>AT</code> field (See <a href="#AT_ENC">Table 1</a>) is
used to program the access-type identifier to count, and its validity is indicated by the
<code>ATV</code> field. When <code>ATV</code> is 0, the counter counts requests with all access-type identifiers,
and the <code>AT</code> value is ignored.</p>
</div>
<div style="page-break-after: always;"></div>
<table id="CC_EVT_ID" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Capacity Usage Monitoring Event ID (<code>EVT_ID</code>)</caption>
<colgroup>
<col style="width: 12.7659%;">
<col style="width: 12.7659%;">
<col style="width: 74.4682%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event ID</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>None</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter does not count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Occupancy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter is incremented by 1 when a request with a
                             matching <code>MCID</code> and <code>AT</code> allocates a unit of
                             capacity. The counter is decremented by 1 when a
                             unit of capacity is de-allocated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128-256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>EVT_ID</code> for a <code>MCID</code> is programmed with a non-zero and legal value by
using the <code>CONFIG_EVENT</code> operation, the counter is reset to 0 and starts counting
matching events for requests with the matching <code>MCID</code> and <code>AT</code> (if <code>ATV</code> is 1).
However, if the <code>EVT_ID</code> is programmed to 0, the counter stops counting.</p>
</div>
<div class="paragraph">
<p>A controller that does not support monitoring by access-type identifier can hardwire the
<code>ATV</code> and the <code>AT</code> fields to 0, indicating that the counter counts requests with
all access-types identifiers.</p>
</div>
<div class="paragraph">
<p>When the <code>cc_mon_ctl</code> register is written, the controller can perform
several actions that might not complete synchronously with the write. A write to
the <code>cc_mon_ctl</code> sets the read-only <code>BUSY</code> bit to 1, indicating the controller
is performing the requested operation. When the <code>BUSY</code> bit reads 0, the operation
is complete, and the read-only <code>STATUS</code> field provides a status value (see
<a href="#CC_MON_STS">Table 5</a> for  details). Written values to the <code>BUSY</code> and the <code>STATUS</code>
fields are ignored. An implementation that can complete the operation
synchronously with the write may hardwire the <code>BUSY</code> bit to 0. The state of the
 <code>BUSY</code> bit, when not hardwired to 0, shall only change in response to a write to
the register. The <code>STATUS</code> field remains valid until a subsequent write to the
<code>cc_mon_ctl</code> register.</p>
</div>
<table id="CC_MON_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <code>cc_mon_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid operation (<code>OP</code>) was requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>MCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>EVT_ID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>BUSY</code> bit is set to 1, the behavior of writes to the <code>cc_mon_ctl</code> is
<code>UNSPECIFIED</code>. Some implementations ignore the second write, while others
might perform the operation determined by the second write. To ensure proper
operation, software must first verify that the <code>BUSY</code> bit is 0 before writing
the <code>cc_mon_ctl</code> register.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_MCTR"><a class="anchor" href="#CC_MCTR"></a>3.3. Capacity Usage Monitoring Counter Value</h3>
<div class="paragraph">
<p>The <code>cc_mon_ctr_val</code> is a read-only register that holds a snapshot of the
counter that is selected by the <code>READ_COUNTER</code> operation. When the controller does not
support capacity usage monitoring, the <code>cc_mon_ctr_val</code> register always reads as
zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAwM9ZRyEvMTbVSUHcOCVKv1UGSUzCEy3n6hYHkYnUUkvPz0jLTrapzEvNSgYqMdBQyigsSk1OtDA2MTGprAWIZHJU=" alt="Capacity Usage Monitoring Counter Value Register (`cc_mon_ctr_val`)">
</div>
<div class="title">Figure 3. Capacity Usage Monitoring Counter Value Register (<code>cc_mon_ctr_val</code>)</div>
</div>
<div class="paragraph">
<p>The counter is valid if the <code>INV</code> field is 0. The counter is marked <code>INV</code> if
the controller determines the count to be not valid for <code>UNSPECIFIED</code> reasons.
The counters marked <code>INV</code> can become valid in future.</p>
</div>
<div class="paragraph">
<p>The counter shall not decrement below zero. If an event occur that would
otherwise result in a negative value, the counter continues to hold a value
of 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Following a reset of the counter to zero, a capacity de-allocation attempts
to drive its value below zero. This scenario occurs when the <code>MCID</code> is
reassigned to a new workload, yet the capacity controller continues to hold
capacity that was initially allocated by the previous workload. In such cases, the
counter shall not decrement below zero and shall remain at zero. After a brief
period of execution for the new workload post-counter reset, the counter value is
expected to stabilize to reflect the capacity usage of this new workload.</p>
</div>
<div class="paragraph">
<p>Some implementations might not store the <code>MCID</code> of the request that caused the
capacity to be allocated with every unit of capacity in the controller to
optimize for the storage overheads. Such controllers, in turn, rely on
statistical sampling to report the capacity usage by tagging only a subset
of the capacity units.</p>
</div>
<div class="paragraph">
<p>Set-sampling is a technique commonly used in caches to estimate the cache
occupancy with a relatively small sample size. The basic idea behind
set-sampling is to select a subset of the cache sets and monitor only those
sets. By keeping track of the hits and misses in the monitored sets, it is
possible to estimate the overall cache occupancy with a high degree of accuracy.
The size of the subset needed to obtain accurate estimates depends on various
factors, such as the size of the cache, the cache access patterns, and the
desired accuracy level. Research cite:[SSAMPLE] shows that set-sampling can
provide statistically accurate estimates with a relatively small sample size,
such as 10% or less, depending on the cache properties and sampling technique
used.</p>
</div>
<div class="paragraph">
<p>When the controller has not observed enough samples to provide an accurate
value in the monitoring counter, it might report the counter as being <code>INV</code>
until more accurate measurements are available. This state helps to prevent inaccurate
or misleading data from being used in capacity planning or other decision-making
processes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="CC_ALLOC"><a class="anchor" href="#CC_ALLOC"></a>3.4. Capacity Allocation Control</h3>
<div class="paragraph">
<p>The <code>cc_alloc_ctl</code> register is used to configure allocation of capacity to an
<code>RCID</code> per access type (<code>AT</code>). The <code>OP</code>, <code>RCID</code> and <code>AT</code> fields in this register
are WARL. If a controller does not support capacity allocation, then this
register is read-only zero. If the controller does not support capacity
allocation per access type, then the <code>AT</code> field is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlgpw9XXDJhQcEeaKaaA6XCw5xDAkNRpU1hMs6hQZHosgZmWCYGqujkJyfl5aZblWdk5iXClKko5BRXJCYnGplaGBkUlsLAD1BQo0=" alt="Capacity Allocation Control Register (`cc_alloc_ctl`)">
</div>
<div class="title">Figure 4. Capacity Allocation Control Register (<code>cc_alloc_ctl</code>)</div>
</div>
<div class="paragraph">
<p>The <code>OP</code> field is used to instruct the capacity controller to perform an
operation listed in <a href="#CC_ALLOC_OP">Table 6</a>. Some operations necessitate the
specification of the <em>capacity blocks</em> to act upon. For such operations, the
targeted <em>capacity blocks</em> are designated in the form of a bitmask in the
<code>cc_block_mask</code> register. Additionally, certain operations require the <em>capacity
unit</em> limit to be defined in the <code>cc_cunits</code> register. To execute operations that
require a capacity block mask and/or a capacity unit limit, software must first
program the <code>cc_block_mask</code> and/or the <code>cc_cunits</code> register, followed by
initiating the operation with the <code>cc_alloc_ctl</code> register.</p>
</div>
<table id="CC_ALLOC_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Capacity Allocation Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a capacity allocation for requests by
                             <code>RCID</code> and of access type <code>AT</code>. The <em>capacity
                             blocks</em> allocation is specified in the
                             <code>cc_block_mask</code> register, and a limit on capacity
                             units is specified in the <code>cc_cunits</code> register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read back the previously configured capacity
                             allocation for requests by <code>RCID</code> and of
                             access-type <code>AT</code>. The configured <em>capacity block</em>
                             allocation is returned as a bit-mask in the
                             <code>cc_block_mask</code> register, and the configured limit
                             on <em>capacity units</em> is available in the <code>cc_cunits</code>
                             register on successful completion of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLUSH_RCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flushes the <em>capacity units</em> used by the specified
                             <code>RCID</code> and access-type <code>AT</code>. This operation is
                             supported if the <code>capabilities.FRCID</code> bit is 1.  <br>
                                                                              <br>
                             The <code>cc_block_mask</code> and <code>cc_cunits</code> registers
                             are not used for this operation.                 <br>
                                                                              <br>
                             The configured <em>capacity block</em> allocation or the
                             <em>capacity unit</em> limit is not changed by this
                             operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Capacity controllers enumerate the allocatable <em>capacity blocks</em> in the <code>NCBLKS</code>
field of the <code>cc_capabilities</code> register. The <code>cc_block_mask</code> register is
programmed with a bit-mask value, where each bit represents a <em>capacity block</em> for the
operation. If configuring <em>capacity unit</em> limits is supported (for example,
<code>cc_capabilities.CUNIT=1</code>), then a limit on the <em>capacity unit</em> that can be
occupied in the allocated capacity blocks can be programmed in the <code>cc_cunits</code>
register. If configuring limits is not supported, then the controller allows
the use of all <em>capacity units</em> in the allocated <em>capacity blocks</em>. A value of
zero programmed into <code>cc_cunits</code> indicates that no limits shall be enforced on
<em>capacity unit</em> allocation.</p>
</div>
<div class="paragraph">
<p>A capacity allocation must be configured for each supported access type by the
controller. An implementation that does not support capacity allocation per
access type can hardwire the <code>AT</code> field to 0 and associate the same capacity
allocation configuration for requests with all access types. When capacity
allocation per access type is supported, identical limits can be configured for
two or more access types, if different capacity allocation per access type is not
required. If capacity is not allocated for each access type supported by the
controller, the behavior is <code>UNSPECIFIED</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A cache controller that supports capacity allocation indicates the number of
allocatable <em>capacity blocks</em> in <code>cc_capabilities.NCBLKS</code> field. For example,
consider a cache with <code>NCBLKS=8</code>. In this example, the <code>RCID=5</code> is
allocated <em>capacity blocks</em> numbered 0 and 1 for requests with access type <code>AT=0</code>,
and <em>capacity blocks</em> numbered 2 for requests with access type
<code>AT=1</code>. The <code>RCID=3</code> in this example is allocated <em>capacity blocks</em>
numbered 3 and 4 for both <code>AT=0</code> and <code>AT=1</code> access types as separate capacity
allocation by access type is not required for this workload. Further in this
example, the <code>RCID=6</code> has been configured with the same <em>capacity block</em>
allocations as <code>RCID=3</code>. This configuration implies that they share a common capacity
allocation in this cache, but might be associated with different <code>RCID</code> to
allow differentiated treatment in another capacity and/or bandwidth controller.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">6</th>
<th class="tableblock halign-center valign-top">5</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=5</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=5</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=6</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=6</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some controllers allow setting a limit on <em>capacity units</em> in allocated capacity
blocks. In exclusive allocations, like for <code>RCID=5</code>, the limit can be the
capacity block&#8217;s maximum capacity. For shared allocations, such as between
<code>RCID=3</code> and <code>RCID=6</code>, individual limits can be set. For example, if two
capacity blocks represent 100 units and <code>RCID=3</code> has a 30-unit limit while
<code>RCID=6</code> has a 70-unit limit, they can use 30% and 70% of the shared capacity
blocks, respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The <code>FLUSH_RCID</code> operation can incur a long latency to complete. However, the
<code>RCID</code> can submit new requests to the controller while it is being flushed.
Additionally, the controller is allowed to deallocate capacity that was allocated
after the operation was initiated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For cache controllers, the <code>FLUSH_RCID</code> operation perfoms an operation
similar to that performed by the RISC-V <code>CBO.FLUSH</code> instruction on each cache
block that is part of the allocation configured for the <code>RCID</code>.</p>
</div>
<div class="paragraph">
<p>The <code>FLUSH_RCID</code> operation can be used as part of reclaiming a previously
allocated <code>RCID</code> and associating it with a new workload. When such a
reallocation is performed, the capacity controllers might have capacity allocated
by the old workload and thus for a short warm-up duration, the capacity controller
might be enforcing capacity allocation limits that reflect the usage by the old
workload. Such warm-up durations are typically not statistically significant, but
if that is not desired, then the <code>FLUSH_RCID</code> operation can be used to flush and
evict capacity allocated by the old workload.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the <code>cc_alloc_ctl</code> register is written, the controller might perform
several actions that might not complete synchronously with the write. A write to
the <code>cc_alloc_ctl</code> sets the read-only <code>BUSY</code> bit to 1, indicating the controller
is performing the requested operation. When the <code>BUSY</code> bit reads 0, the operation
is complete, and the read-only <code>STATUS</code> field provides a status value
(<a href="#CC_ALLOC_STS">Table 7</a>) of the requested operation. Values that are written to the <code>BUSY</code> and
the <code>STATUS</code> fields are always ignored. An implementation that can complete the
operation synchronously with the write might hardwire the <code>BUSY</code> bit to 0. The
state of the <code>BUSY</code> bit, when not hardwired to 0, shall change only in response
to a write to the register. The <code>STATUS</code> field remains valid until a subsequent
write to the <code>cc_alloc_ctl</code> register.</p>
</div>
<table id="CC_ALLOC_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. <code>cc_alloc_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid or unsupported operation (<code>OP</code>) requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>RCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid <em>capacity block</em> mask was specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>BUSY</code> bit is set to 1, the behavior of writes to the <code>cc_alloc_ctl</code>
register, <code>cc_cunits</code> register, or to the <code>cc_block_mask</code> register is
<code>UNSPECIFIED</code>. Some implementations might ignore the second write and others might
perform the operation determined by the second write. To ensure proper operation,
software must verify that <code>BUSY</code> bit  is 0 before writing any of these registers.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_BMASK"><a class="anchor" href="#CC_BMASK"></a>3.5. Capacity Block Mask (<code>cc_block_mask</code>)</h3>
<div class="paragraph">
<p>The <code>cc_block_mask</code> is a WARL register. If the controller does not support
capacity allocation, for example, <code>NCBLKS</code> is 0, then this register is read-only 0.</p>
</div>
<div class="paragraph">
<p>The register has <code>NCBLKS</code> bits, each corresponding to one allocatable
<em>capacity block</em> in the controller. The width of this register is variable, but
always a multiple of 64 bits. The bitmap width in bits (<code>BMW</code>) is determined by
the following equation. The division operation in this equation is an integer
division.</p>
</div>
<div id="eq-2" class="stemblock">
<div class="content">
\[\begin{equation}
BMW = \lfloor{\frac{NCBLKS + 63}{64}}\rfloor \times 64
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>Bits <code>NCBLKS-1:0</code> are read-write, and the bits <code>BMW-1:NCBLKS</code> are read-only zero.</p>
</div>
<div class="paragraph">
<p>The process of configuring capacity allocation for an <code>RCID</code> and <code>AT</code> begins by
programming the <code>cc_block_mask</code> register with a bit-mask value that identifies the
<em>capacity blocks</em> to be allocated and, if supported, by programming the
<code>cc_cunits</code> register with a limit on the capacity units that might be occupied in
those capacity blocks. Next, the <code>cc_alloc_ctl register</code> is written to request a
<code>CONFIG_LIMIT</code> operation for the <code>RCID</code> and <code>AT</code>. After a capacity allocation
limit is established, a request can be allocated capacity in the <em>capacity
blocks</em> allocated to the <code>RCID</code> and <code>AT</code> associated with the request. It is
important to note that some implementations might require at least one <em>capacity
block</em> to be allocated by using <code>cc_block_mask</code> when allocating capacity;
otherwise, the operation fails with <code>STATUS=5</code>.  Overlapping <em>capacity block</em>
masks among <code>RCID</code> and/or <code>AT</code> are allowed to be configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A multiway set-associative cache controller that supports capacity allocation <em>by
ways</em> can advertise <code>NCBLKS</code> as the number of ways per set in the cache. To allocate
capacity in such a cache for an <code>RCID</code> and <code>AT</code>, a subset of ways must be
selected and a mask of the selected ways must be programmed in <code>cc_block_mask</code> field when
the <code>CONFIG_LIMIT</code> operation is requested.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To read the <em>capacity block</em> allocation for an <code>RCID</code> and <code>AT</code>, the controller
provides the <code>READ_LIMIT</code> operation, which can be requested by writing to the
<code>cc_alloc_ctl</code> register. When the operation completes successfully, the
<code>cc_block_mask</code> register holds the configured <em>capacity block</em> allocation.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_CUNITS"><a class="anchor" href="#CC_CUNITS"></a>3.6. Capacity Units</h3>
<div class="paragraph">
<p>The <code>cc_cunits</code> register is a read-write WARL register. If the controller does
not support capacity allocation (for example, <code>NCBLKS</code> is set to 0), this register
shall be read-only zero.</p>
</div>
<div class="paragraph">
<p>If the controller does not support configuring limits on <em>capacity units</em> that
may be occupied in the allocated <em>capacity blocks</em> (for example,
<code>cc_capabilities.CUNITS=0</code>), then this register shall be read-only zero. In such
cases, the controller allows the utilization of all available <em>capacity units</em> by
an <code>RCID</code> within the <em>capacity blocks</em> allocated to it.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>If the controller supports configuring limits on <em>capacity units</em> that might be
occupied in the allocated <em>capacity blocks</em> (for example, <code>cc_capabilities.CUNITS=1</code>)
then this register sets an upper limit on the number of <em>capacity units</em> that
can be occupied by an <code>RCID</code> in the <em>capacity blocks</em> allocated for an <code>AT</code>. A
value of zero specified in the <code>cc_cunits</code> register indicates that no limit is
configured.</p>
</div>
<div class="paragraph">
<p>The sum of the <code>cc_cunits</code> configured for the <code>RCID</code> sharing a <em>capacity block</em>
allocation may exceed the <em>capacity units</em> represented by that <em>capacity block</em>
allocation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When multiple <code>RCID</code> instances share a <em>capacity block</em> allocation, the
<code>cc_cunits</code> register can be employed to set an upper limit on the number of
<em>capacity units</em> each <code>RCID</code> can occupy.</p>
</div>
<div class="paragraph">
<p>For instance, consider a group of four <code>RCID</code> instances configured to share a
set of <em>capacity blocks</em>, representing a total of 100 capacity units. Each
<code>RCID</code> can be configured with a limit of 30 capacity units, ensuring that no
individual <code>RCID</code> exceeds 30% of the total shared <em>capacity units</em>.</p>
</div>
<div class="paragraph">
<p>The capacity controller might enforce these limits through various techniques.
Examples include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refraining from allocating new capacity units to an <code>RCID</code> that reached
its limit.</p>
</li>
<li>
<p>Evicting previously allocated capacity units when a new allocation is
required.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These methods are not exhaustive and can be applied either individually or in
combination to maintain <em>capacity unit</em> limits.</p>
</div>
<div class="paragraph">
<p>When the limit on the <em>capacity units</em> is reached or is about to be reached,
the capacity controller can initiate additional operations. These could include
throttling certain activities (for example, prefetches) of the corresponding workload
requests.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To read the <em>capacity unit</em> limit for an <code>RCID</code> and <code>AT</code>, the controller
provides the <code>READ_LIMIT</code> operation that can be requested by writing to the
<code>cc_alloc_ctl</code> register. When the operation completes successfully, the
<code>cc_cunits</code> register holds the configured <em>capacity unit</em> allocation limit.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="BC_QOS"><a class="anchor" href="#BC_QOS"></a>4. Bandwidth-controller QoS Register Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controllers, such as memory controllers, that support bandwidth allocation and
bandwidth usage monitoring provide a memory-mapped bandwidth-controller QoS
register interface.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Bandwidth-controller QoS Register Layout (size and offset are in bytes)</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 25.641%;">
<col style="width: 7.6923%;">
<col style="width: 46.1538%;">
<col style="width: 12.8206%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offset</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Optional?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc_capabilities</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BC_CAP">Capabilities</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc_mon_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BC_MCTL">Usage monitoring
                                      control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc_mon_ctr_val</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BC_MCTR">Monitoring
                                      counter value</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc_alloc_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BC_ALLOC">Bandwidth
                                    allocation control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bc_bw_alloc</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BC_BMASK">Bandwidth
                                    allocation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The reset value is 0 for the following register fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bc_mon_ctl.BUSY</code> field</p>
</li>
<li>
<p><code>bc_alloc_ctl.BUSY</code> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reset value is <code>UNSPECIFIED</code> for all other register fields.</p>
</div>
<div class="paragraph">
<p>The bandwidth controllers at reset must allocate all available bandwidth to
<code>RCID</code> value of 0. When the bandwidth controller supports bandwidth allocation
per access-type, the access-type value of 0 of <code>RCID=0</code> is allocated all
available bandwidth, while all other access-types associated with that <code>RCID</code>
share the bandwidth allocation with <code>AT=0</code>. The bandwidth allocation for all
other <code>RCID</code> values is <code>UNSPECIFIED</code>. The bandwidth controller behavior in
handling a request with a non-zero <code>RCID</code> value before configuring the bandwidth
controller with bandwidth allocation for that <code>RCID</code> is also <code>UNSPECIFIED</code>.</p>
</div>
<div class="sect2">
<h3 id="BC_CAP"><a class="anchor" href="#BC_CAP"></a>4.1. Bandwidth-controller Capabilities</h3>
<div class="paragraph">
<p>The <code>bc_capabilities</code> register is a read-only register that holds the
bandwidth-controller capabilities.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlCw0FHIS8xNtVJQD3MNUq_VQUgZmsGl_JzCnXy8g1GkFQzh0kEBbhGociZwuQBUCWO4RHhAkCcu-3yDgBbikoRpjNVRSM7PS8tMt6rOScxLBSoC2ppRXJCYnGplaGBkUlsLANcGQyU=" alt="Bandwidth-controller Capabilities Register">
</div>
<div class="title">Figure 5. Bandwidth-controller Capabilities Register</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The <code>VER</code> field holds the version of the specification implemented by the
bandwidth controller. The low nibble is used to hold the minor version of the
specification and the upper nibble is used to hold the major version of the
specification. For example, an implementation that supports version 1.0 of the
specification reports <code>0x10</code>.</p>
</div>
<div class="paragraph">
<p>The <code>NBWBLKS</code> field holds the total number of available bandwidth blocks in
the controller. The bandwidth represented by each bandwidth block is
<code>UNSPECIFIED</code>. The bandwidth controller supports reserving bandwidth in
multiples of a bandwidth block, which enables proportional allocation of
bandwidth.</p>
</div>
<div class="paragraph">
<p>Bandwidth controllers can limit the maximum bandwidth that can be reserved to
a value smaller than the <code>NBWBLKS</code> value. The <code>MRBWB</code> field reports the maximum number of
bandwidth blocks that can be reserved.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The bandwidth controller meters the bandwidth usage by a workload to
determine if it is exceeding its allocations and, if necessary, take
measures to throttle the workload&#8217;s bandwidth usage. Therefore, the instantaneous
bandwidth used by a workload either exceeds or falls short of the configured
allocation. QoS capabilities are statistical in nature and are typically
designed to enforce the configured bandwidth over larger time windows. By not
allowing all available bandwidth blocks to be reserved for allocation, the
bandwidth controller can handle such transient inaccuracies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the <code>RCID</code>-prefixed mode (<code>RPFX</code>) is 1, the controller operates in <code>RPFX</code>
mode. The parameter <code>P</code> (prefixed bits) indicates the number of least significant
bits of the <code>MCID</code> carried in the request that should be prefixed by the RCID. The
controller uses <code>RCID</code> in the requests along with <code>P</code> number of least significant
bits of the <code>MCID</code> to compute an effective <code>MCID</code> (<a href="#EMCID">Section 2.1</a>). This <code>MCID</code> is used
to identify the monitoring counter. Legal values of <code>P</code> range from 0 to 12.</p>
</div>
<div class="paragraph">
<p>If <code>RPFX</code> is 0, <code>P</code> is set to 0, and the effective <code>MCID</code> is the same as the <code>MCID</code>
in the request.</p>
</div>
</div>
<div class="sect2">
<h3 id="BC_MCTL"><a class="anchor" href="#BC_MCTL"></a>4.2. Bandwidth Usage Monitoring Control</h3>
<div class="paragraph">
<p>The <code>bc_mon_ctl</code> register controls the monitoring of bandwidth usage by a
<code>MCID</code>. When the controller does not support bandwidth usage monitoring, the
<code>bc_mon_ctl</code> register is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlfJ09XVB1WcDlXMNC4tFlDZHMDMNlXXhAkCeqnDlcLjjEMSQ0GJehTqHBkShyRiYYpsbqKCTn56VlpltV5yTmpYIU6ShkFBckJqdaGRoYmdTWAgBWNFIF" alt="Bandwidth Usage Monitoring Control Register (`bc_mon_ctl`)">
</div>
<div class="title">Figure 6. Bandwidth Usage Monitoring Control Register (<code>bc_mon_ctl</code>)</div>
</div>
<div class="paragraph">
<p>Bandwidth controllers that support bandwidth usage monitoring implement a usage
monitoring counter for each supported <code>MCID</code>. The usage monitoring counter might
be configured to count a monitoring event. When an event matching the event
configured for the <code>MCID</code> occurs, then the monitoring counter is updated. The
event matching can optionally be filtered by the access-type. The monitoring
counter for bandwidth usage counts the number of bytes transferred by requests
matching the monitoring event as the requests go past the monitoring point.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code>, <code>AT</code>, <code>MCID</code>, and <code>EVT_ID</code> fields of the register are WARL fields.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code> field is used to instruct the controller to perform an operation
listed in <a href="#BC_MON_OP">Table 9</a>.</p>
</div>
<table id="BC_MON_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Bandwidth Usage Monitoring Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_EVENT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the counter selected by <code>MCID</code> to count
                             the event selected by <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code>.
                             The <code>EVT_ID</code> encodings are listed in <a href="#BC_EVT_ID">Table 10</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_COUNTER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot the value of the counter selected by
                             <code>MCID</code> into <code>bc_mon_ctr_val</code> register. The
                             <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code> fields are not used by
                             this operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>CONFIG_EVENT</code> operation uses the <code>EVT_ID</code> operand to program the identifier of the
event to count in the monitoring counter, selected by <code>MCID</code>.
The <code>AT</code> field is used to program the access-type to count, and its validity is
indicated by the <code>ATV</code> field. When <code>ATV</code> is 0, the counter counts requests with
all access-types, and the <code>AT</code> value is ignored.</p>
</div>
<table id="BC_EVT_ID" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Bandwidth Monitoring Event ID (<code>EVT_ID</code>)</caption>
<colgroup>
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event ID</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>None</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter does not count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Total Read
  and Write
  byte count</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter is incremented by the number of bytes
                             transferred by a matching read or write request
                             as the requests go past the monitor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Total Read
  byte count</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter is incremented by the number of bytes
                             transferred by a matching read request as the
                             requests go past the monitor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Total Write
  byte count</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter is incremented by the number of bytes
                             transferred by a matching write request as the
                             requests go past the monitor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128-256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>EVT_ID</code> for a <code>MCID</code> is programmed with a non-zero and legal value,
the counter is reset to 0 and starts counting matching events for requests with
the matching <code>MCID</code> and <code>AT</code> (if <code>ATV</code> is 1). However, if the <code>EVT_ID</code> is
configured as 0, the counter stops counting.</p>
</div>
<div class="paragraph">
<p>A controller that does not support monitoring by access-type can hardwire the
<code>ATV</code> and the <code>AT</code> fields to 0, indicating that the counter counts requests with
all access-types.</p>
</div>
<div class="paragraph">
<p>When the <code>bc_mon_ctl</code> register is written, the controller may need to perform
several actions that may not complete synchronously with the write. A write to
the <code>bc_mon_ctl</code> register sets the read-only <code>BUSY</code> bit to 1, indicating that the
controller is performing the requested operation. When the <code>BUSY</code> bit reads 0, the
operation is complete, and the read-only <code>STATUS</code> field provides a status value
(see <a href="#BC_MON_STS">Table 11</a> for details). Written values to the <code>BUSY</code> and the <code>STATUS</code>
fields are ignored. An implementation that can complete the operation
synchronously with the write may hardwire the <code>BUSY</code> bit to 0. The state of the
<code>BUSY</code> bit, when not hardwired to 0, shall only change in response to a write to
the register. The <code>STATUS</code> field remains valid until a subsequent write to the
<code>bc_mon_ctl</code> register.</p>
</div>
<table id="BC_MON_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. <code>bc_mon_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid operation (<code>OP</code>) was requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>MCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>EVT_ID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>BUSY</code> bit is set to 1, the behavior of writes to the <code>bc_mon_ctl</code> is
<code>UNSPECIFIED</code>. Some implementations may ignore the second write, while others
may perform the operation determined by the second write. To ensure proper
operation, software must first verify that the <code>BUSY</code> bit is 0 before writing
the <code>bc_mon_ctl</code> register.</p>
</div>
</div>
<div class="sect2">
<h3 id="BC_MCTR"><a class="anchor" href="#BC_MCTR"></a>4.3. Bandwidth Monitoring Counter Value</h3>
<div class="paragraph">
<p>The <code>bc_mon_ctr_val</code> is a read-only register that holds a snapshot of the
counter selected by a <code>READ_COUNTER</code> operation. When the controller does not
support bandwidth usage monitoring, the <code>bc_mon_ctr_val</code> register always reads
as zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAwM9JRyEvMTbVSUHcOCVKv1UGSUzCEy3n6heGU8w9zA8nF6igk5-elZaZbVeck5qUCFQGNziguSExOtTI0MDKprQUAtS4j_w==" alt="Bandwidth Monitoring Counter Value Register (`bc_mon_ctr_val`)">
</div>
<div class="title">Figure 7. Bandwidth Monitoring Counter Value Register (<code>bc_mon_ctr_val</code>)</div>
</div>
<div class="paragraph">
<p>The counter is valid if the <code>INV</code> field is 0. The counter may be marked
<code>INV</code> if, for <code>UNSPECIFIED</code> reasons, the controller determines the count to be
not valid. Such counters may become valid in the future. Additionally, if an
unsigned integer overflow of the counter occurs, then the <code>OVF</code> bit is set to 1.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A counter may be marked as <code>INV</code> if the controller has not been able to
establish an accurate counter value for the monitored event.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The counter provides the number of bytes transferred by requests matching the
<code>EVT_ID</code> as they go past the monitoring point. A bandwidth value may be
determined by reading the byte count value at two instances of time <code>T1</code> and
<code>T2</code>. If the value of the counter at time <code>T1</code> was <code>B1</code>, and at time <code>T2</code> is
<code>B2</code>, then the bandwidth can be calculated using <a href="#eq-3">equation (2)</a>. The frequency of the
time source is represented by \(T_{freq}\).</p>
</div>
<div id="eq-3" class="stemblock">
<div class="content">
\[\begin{equation}
Bandwidth = T_{freq} \times \frac{ B2 - B1 }{T2 - T1}
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>The width of the counter is <code>UNSPECIFIED</code> but the unimplemented bits must be
read-only zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While the width of the counter is <code>UNSPECIFIED</code>, it is recommended to be wide
enough to prevent more than one overflow per sample when the sampling frequency
is 1 Hz.</p>
</div>
<div class="paragraph">
<p>If an overflow was detected then software may discard that sample and reset the
counter and overflow indication by reprogramming the event using <code>CONFIG_EVENT</code>
operation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="BC_ALLOC"><a class="anchor" href="#BC_ALLOC"></a>4.4. Bandwidth Allocation Control</h3>
<div class="paragraph">
<p>The <code>bc_alloc_ctl</code> register is used to control the allocation of bandwidth to an
<code>RCID</code> per <code>AT</code>. If a controller does not support bandwidth allocation, then the
register is read-only zero. If the controller does not support bandwidth
allocation per access-type, then the <code>AT</code> field is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlgpw9XXDJhQcEeaKaaA6XCw5xDAkNRpU1hMs6hQZHosgZmWCYGqujkJyfl5aZblWdk5iXClKko5BRXJCYnGplaGBkUlsLAD1BQo0=" alt="Bandwidth Allocation Control Register (`bc_alloc_ctl`)">
</div>
<div class="title">Figure 8. Bandwidth Allocation Control Register (<code>bc_alloc_ctl</code>)</div>
</div>
<div class="paragraph">
<p>The <code>OP</code> field instructs the bandwidth controller to perform an operation listed
in <a href="#BC_ALLOC_OP">Table 12</a>. The <code>bc_alloc_ctl</code> register is used in conjunction with the
<code>bc_bw_alloc</code> register to perform bandwidth allocation operations. If the
requested operation uses the operands configured in <code>bc_bw_alloc</code>, software must
first program the <code>bc_bw_alloc</code> register with the operands for the operation
before requesting the operation.</p>
</div>
<table id="BC_ALLOC_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Bandwidth Allocation Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Establishes reserved bandwidth allocation for
                             requests by <code>RCID</code> and of access-type <code>AT</code>. The
                             bandwidth allocation is specified in <code>bc_bw_alloc</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads back the previously configured bandwidth
                             allocation for requests by <code>RCID</code> and of
                             access-type <code>AT</code>. The current configured allocation
                             is written to <code>bc_bw_alloc</code> on completion of the
                             operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>A bandwidth allocation must be configured for each access-type supported by
the controller. When differentiated bandwidth allocation based on access-type
is not required, one of the access-types may be designated to hold a default
bandwidth allocation, and the other access-types can be configured to share the
allocation with the default access-type. If bandwidth is not allocated for each
access-type supported by the controller, the behavior is <code>UNSPECIFIED</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>bc_alloc_ctl</code> register is written, the controller may need to perform
several actions that may not complete synchronously with the write. A write to
the <code>bc_alloc_ctl</code> sets the read-only <code>BUSY</code> bit to 1 indicating the controller
is performing the requested operation. When the <code>BUSY</code> bit reads 0, the operation
is complete, and the read-only <code>STATUS</code> field provides a status value (see
<a href="#BC_ALLOC_STS">Table 13</a> for  details). Written values to the <code>BUSY</code> and the <code>STATUS</code>
fields are ignored. An implementation that can complete the operation
synchronously with the write may hardwire the <code>BUSY</code> bit to 0. The state of the
<code>BUSY</code> bit, when not hardwired to 0, shall only change in response to a write to
the register. The <code>STATUS</code> field remains valid until a subsequent write to the
<code>bc_alloc_ctl</code> register.</p>
</div>
<table id="BC_ALLOC_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. <code>bc_alloc_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid operation (<code>OP</code>) was requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>RCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid or unsupported reserved bandwidth block was requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="BC_BMASK"><a class="anchor" href="#BC_BMASK"></a>4.5. Bandwidth Allocation Configuration</h3>
<div class="paragraph">
<p>The <code>bc_bw_alloc</code> is used to program reserved bandwidth blocks (<code>Rbwb</code>) for an
<code>RCID</code> for requests of access-type <code>AT</code> using the <code>CONFIG_LIMIT</code> operation. If a
controller does not support bandwidth allocation, then the <code>bc_bw_alloc</code> register
is read-only zero.</p>
</div>
<div class="paragraph">
<p>The <code>bc_bw_alloc</code> holds the previously configured reserved bandwidth blocks for
an <code>RCID</code> and <code>AT</code> on successful completion of the <code>READ_LIMIT</code> operation.</p>
</div>
<div class="paragraph">
<p>Bandwidth is allocated in multiples of bandwidth blocks, and the value in <code>Rbwb</code>
must be at least 1 and must not exceed <code>MRBWB</code> value. Otherwise, the <code>CONFIG_LIMIT</code>
operation fails with <code>STATUS=5</code>. Additionally, the sum of <code>Rbwb</code> allocated
across all <code>RCIDs</code> must not exceed <code>MRBWB</code> value, or the <code>CONFIG_LIMIT</code> operation
fails with <code>STATUS=5</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA001HIS8xNtVJQD0oqT1Kv1UHIKZjA5cIDgjxR5Szgcr7lqZnpGSWo0sZw6eKMxKLUFMcQVHlDuHxpcWowWAmKAmMjDLtjdRSS8_PSMtOtqnMS81KBioDuyyguSExOtTI0MDKprQUAK-hBtQ==" alt="Bandwidth Allocation Configuration Register (`bc_bw_alloc`)">
</div>
<div class="title">Figure 9. Bandwidth Allocation Configuration Register (<code>bc_bw_alloc</code>)</div>
</div>
<div class="paragraph">
<p>The <code>Rbwb</code>, <code>Mweight</code>, <code>sharedAT</code>, and <code>useShared</code> are all WARL fields.</p>
</div>
<div class="paragraph">
<p>Bandwidth allocation is typically enforced by the bandwidth controller over
finite accounting windows. The process involves measuring the bandwidth
consumption over an accounting window and determining if an <code>RCID</code> is exceeding
its bandwidth allocations for each access-types. The specifics of how the
accounting window is implemented are <code>UNSPECIFIED</code>, but is expected to provide
a statistically accurate control of the bandwidth usage over a few accounting
intervals.</p>
</div>
<div class="paragraph">
<p>The <code>Rbwb</code> field represents the bandwidth that is made available to an <code>RCID</code> for
requests that match <code>AT</code>, even when all other <code>RCID</code> are using their full
allocation of bandwidth. The bandwidth allocation scales linearly with the
number of bandwidth blocks programmed into <code>Rbwb</code>.</p>
</div>
<div class="paragraph">
<p>If there is non-reserved or unused bandwidth available in an accounting
interval, <code>RCIDs</code> may compete for additional bandwidth. The non-reserved or
unused bandwidth is proportionately shared among the competing <code>RCIDs</code> by using the
configured <code>Mweight</code> parameter, which is a number between 0 and 255. A larger
weight implies a greater fraction of the bandwidth. A weight of 0 implies that
the configured limit is a hard limit, and the use of unused or non-reserved
bandwidth is not allowed.</p>
</div>
<div class="paragraph">
<p>Sharing of non-reserved bandwidth is not differentiated by access-type identifier.
Therefore, the <code>Mweight</code> parameter must be programmed identically for all
access-type identifiers. If this parameter is programmed differently for each access-type
identifier, then the controller can use the parameter configured for any of the
identifiers, but the behavior is otherwise well defined.</p>
</div>
<div class="paragraph">
<p>When the <code>Mweight</code> parameter is not set to 0, the amount of unused bandwidth
allocated to <code>RCID=x</code> during contention with another <code>RCID</code> that is also
permitted to use unused bandwidth is determined by dividing the <code>Mweight</code> of
<code>RCID=x</code> by the sum of the <code>Mweight</code> of all other contending <code>RCIDs</code>. This
ratio <code>P</code> is determined by <a href="#eq-4">equation (3)</a>.</p>
</div>
<div id="eq-4" class="stemblock">
<div class="content">
\[\begin{equation}
P = \frac{Mweight_{x}}{\sum_{r=1}^{r=n} Mweight_{r}}
\end{equation}\]
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The bandwidth enforcement is typically work-conserving, allowing unused bandwidth
 to be used by requestors that are enabled to use it, even if they have
consumed their <code>Rbwb</code> allotment.</p>
</div>
<div class="paragraph">
<p>When contending for unused bandwidth, the weighted share is typically
computed among the <code>RCIDs</code> that are actively generating requests in that
accounting interval and have a non-zero weight programmed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If unique bandwidth allocation is not required for an access-type identifier, then the
<code>useShared</code> parameter can be set to 1 for a <code>CONFIG_LIMIT</code> operation. When
<code>useShared</code> is set to 1, the <code>sharedAT</code> field specifies the access-type identifer with
which the bandwidth allocation is shared by the access-type identifier in
<code>bc_alloc_ctl.AT</code>. In this case, the <code>Rbwb</code> and <code>Mweight</code> fields are ignored,
and the configurations of the access-type identifier in <code>sharedAT</code> are applied. If the
access-type identifier specified by <code>sharedAT</code> does not have unique bandwidth allocation,
meaning that it has not been configured with <code>useShared=0</code>, then the behavior
is <code>UNSPECIFIED</code>.</p>
</div>
<div class="paragraph">
<p>The <code>useShared</code> and <code>sharedAT</code> fields are read-only zero if the bandwidth
controller does not support bandwidth allocation per access-type identifier.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When unique bandwidth allocation for an access-type identifier is not required, then one or
more identifiers might be configured with a shared bandwidth allocation. For
example, consider a bandwidth controller that supports 3 access-type identifers. The
access-type identifier 0 and 1 of <code>RCID</code> 3 are configured with unique bandwidth allocations
and the access-type identifier 2 is configured to share bandwidth allocation with
identifier 1. The example configuration is illustrated in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top"><code>Rbwb</code></th>
<th class="tableblock halign-center valign-top"><code>Mweight</code></th>
<th class="tableblock halign-center valign-top"><code>useShared</code></th>
<th class="tableblock halign-center valign-top"><code>sharedAT</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N/A</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>50</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N/A</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N/A</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N/A</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QOS_IOMMU"><a class="anchor" href="#QOS_IOMMU"></a>5. IOMMU Extension for QoS ID</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A method to associate QoS IDs with requests to access resources by the Input-Output
Memory Management Unit (IOMMU), as well as with devices governed by it, is required
for effective monitoring and allocation. This section specifies a RISC-V I
OMMU cite:[IOMMU] extension for the following goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure and associate QoS IDs for device-originated requests.</p>
</li>
<li>
<p>Configure and associate QoS IDs for IOMMU-originated requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The size (or width) of <code>RCID</code> and <code>MCID</code>, as fields in registers or in data
structures, supported by the IOMMU must be at least as large as that supported
by any RISC-V application processor hart in the system.</p>
</div>
<div class="sect2">
<h3 id="iommu-registers"><a class="anchor" href="#iommu-registers"></a>5.1. IOMMU Registers</h3>
<div class="paragraph">
<p>The specified memory-mapped register layout defines a new IOMMU register named
<code>iommu_qosid</code>. This register is used to configure the Quality of Service (QoS)
IDs associated with IOMMU-originated requests. The register is 4 bytes in size
and is located at an offset of 624 from the beginning of the memory-mapped region.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. IOMMU Memory-mapped Register Layout</caption>
<colgroup>
<col style="width: 8.8235%;">
<col style="width: 17.647%;">
<col style="width: 8.8235%;">
<col style="width: 35.2941%;">
<col style="width: 29.4119%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offset</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Is Optional?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">624</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iommu_qosid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QoS IDs for IOMMU requests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">628</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future use (<code>WPRI</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="reset-behavior"><a class="anchor" href="#reset-behavior"></a>5.1.1. Reset Behavior</h4>
<div class="paragraph">
<p>If the reset value for <code>ddtp.iommu_mode</code> field is <code>Bare</code>, then the
<code>iommu_qosid.RCID</code> field must have a reset value of 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At reset, it is required that the <code>RCID</code> field of <code>iommu_qosid</code> is set to 0 if
the IOMMU is in <code>Bare</code> mode, as typically the resource controllers in the
SoC default to a reset behavior of associating all capacity or bandwidth to the
<code>RCID</code> value of 0. When the reset value of the <code>ddtp.iommu_mode</code> is not <code>Bare</code>,
the <code>iommu_qosid</code> register should be initialized by software before changing
the mode to allow DMA.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="iommu-capabilities"><a class="anchor" href="#iommu-capabilities"></a>5.1.2. IOMMU Capabilities</h4>
<div class="paragraph">
<p>The IOMMU <code>capabilities</code> register is extended with a new field, <code>QOSID</code>, which
enumerates support for associating QoS IDs with requests made through the IOMMU.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqF080KgkAUBeB9TzG7Ni50nNJmN2GZkGUptIgQtamE_MExCcR3jwgMgzutv7mHw71MW_ErRccRQm2c1oIiU0F5lHGKxg2vRFrk4075qtar3-gYphlIxARpYgxI76niglcNP4OTZZzVkp5PImkqQWJKcGKA-Kcvc7ehu3eWALu-Ey7XLJCwZPodvjowC-LAByTAtscAW2yGebgXx4byVp4LiDW3BzLtxWNQmmeZoGgGSFgFaLf1nZ8dEfn9vh8jeYi6yN54UlBS5Jf0Stt7lPPPq5soo4RTTcWk615mSfZB" alt="IOMMU Capabilities Register">
</div>
<div class="title">Figure 10. IOMMU Capabilities Register</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bits</th>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QOSID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associating QoS IDs with requests is supported.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="iommu-qos-id"><a class="anchor" href="#iommu-qos-id"></a>5.1.3. IOMMU QoS ID</h4>
<div class="paragraph">
<p>The <code>iommu_qosid</code> register fields are defined as follows:</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA00lHIS8xNtVJQD3L2dFGv1UHIKZjA5cIDgjxR5JD0-RKhL1ZHITk_Ly0z3ao6JzEvFWSAjkJGcUFicqqVoYGRSW0tABHXLBM=" alt="`iommu_qosid` register fields">
</div>
<div class="title">Figure 11. <code>iommu_qosid</code> register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID</code> for IOMMU-initiated requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MCID</code> for IOMMU-initiated requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>IOMMU-initiated requests for accessing the following data structures use the
value programmed in the <code>RCID</code> and <code>MCID</code> fields of the <code>iommu_qosid</code> register.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Device directory table (<code>DDT</code>)</p>
</li>
<li>
<p>Fault queue (<code>FQ</code>)</p>
</li>
<li>
<p>Command queue (<code>CQ</code>)</p>
</li>
<li>
<p>Page-request queue (<code>PQ</code>)</p>
</li>
<li>
<p>IOMMU-initiated MSI (Message-signaled interrupts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <code>ddtp.iommu_mode == Bare</code>, all device-originated requests are
associated with the QoS IDs configured in the <code>iommu_qosid</code> register.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="device-context-fields"><a class="anchor" href="#device-context-fields"></a>5.2. Device-context Fields</h3>
<div class="paragraph">
<p>The <code>ta</code> field of the device context is extended with two new fields, <code>RCID</code>
and <code>MCID</code>, to configure the QoS IDs to associate with requests originated by the
devices.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA00lHIS8xNtVJQL0otTi0qS01Rr9VByBsZwOUDgp09XVAkFSzwa0YyPAhdL5KcL1QuVkchOT8vLTPdqjonMS8VZLuOQkZxQWIyUJWhgZGJjkJafl5JcWYViG9WWwsAegQ85g==" alt="Translation Attributes (`ta`) Field">
</div>
<div class="title">Figure 12. Translation Attributes (<code>ta</code>) Field</div>
</div>
<div class="paragraph">
<p>IOMMU-initiated requests for accessing the following data structures use the
value configured in the <code>RCID</code> and <code>MCID</code> fields of <code>DC.ta</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Process directory table (<code>PDT</code>)</p>
</li>
<li>
<p>Second-stage page table</p>
</li>
<li>
<p>First-stage page table</p>
</li>
<li>
<p>MSI page table</p>
</li>
<li>
<p>Memory-resident interrupt file (<code>MRIF</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>RCID</code> and <code>MCID</code> configured in <code>DC.ta</code> are provided to the IO bridge on
successful address translations. The IO bridge should associate these QoS IDs
with device-initiated requests.</p>
</div>
<div class="paragraph">
<p>If <code>capabilities.QOSID</code> is 1 and <code>DC.ta.RCID</code> or <code>DC.ta.MCID</code> is wider than that
supported by the IOMMU, a <code>DC</code> with <code>DC.tc.V=1</code> is considered misconfigured. In
this case, the IOMMU should stop and report "DDT entry misconfigured" (cause =
259).</p>
</div>
</div>
<div class="sect2">
<h3 id="iommu-atc-capacity-allocation-and-monitoring"><a class="anchor" href="#iommu-atc-capacity-allocation-and-monitoring"></a>5.3. IOMMU ATC Capacity Allocation and Monitoring</h3>
<div class="paragraph">
<p>Some IOMMUs might support capacity allocation and usage monitoring in the IOMMU
address translation cache (IOATC) by implementing the capacity controller
register interface.</p>
</div>
<div class="paragraph">
<p>Additionally, some IOMMUs might support multiple IOATCs, each potentially having
different capacities. In scenarios where multiple IOATCs are implemented, such
as an IOATC for each supported page size, the IOMMU can implement a
capacity controller register interface for each IOATC to facilitate individual
capacity allocation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QOS_HW_GUIDE"><a class="anchor" href="#QOS_HW_GUIDE"></a>6. Hardware Guidelines</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="QOS_SIZING"><a class="anchor" href="#QOS_SIZING"></a>6.1. Sizing QoS Identifiers</h3>
<div class="paragraph">
<p>In a typical implementation, the number of <code>RCID</code> bits implemented (for example, to
support 10s of <code>RCIDs</code>) might be smaller than the number of <code>MCID</code> bits
implemented (for example, to support 100s of <code>MCIDs</code>).</p>
</div>
<div class="paragraph">
<p>It is a typical usage to associate a group of applications/VMs with a common
<code>RCID</code> and thus sharing a common pool of resource allocations. The resource
allocations for the <code>RCID</code> is established to meet the SLA objectives of all
members of the group. If SLA objectives of one or more members of the group
stop being met, the resource usage of one or more members of the group might be
monitored by associating them with a unique <code>MCID</code> and this iterative analysis
process used to determine the optimal strategy - increasing resources allocated
to the <code>RCID</code>, moving some members to a different <code>RCID</code>, migrating some members
away to another machine, and so on - for restoring the SLA. Having a sufficiently
large pool of <code>MCID</code> speeds up this analysis.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To maximize flexibility in the allocation of QoS IDs to workloads, it is
recommended that all resource controllers in the system support an identical
number of <code>RCID</code> and <code>MCID</code>, as well as a uniform mode of operation â either
direct or RCID-prefixed â for determining the effective <code>MCID</code>. Uniformity
ensures that software is not constrained by the lowest common denominator of ID
support when requests are processed by multiple controllers, such as caches,
fabrics, and memory controllers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sizing-monitoring-counters"><a class="anchor" href="#sizing-monitoring-counters"></a>6.2. Sizing Monitoring Counters</h3>
<div class="paragraph">
<p>Typically software samples the monitoring counters periodically to monitor
capacity and bandwidth usage. The width of the monitoring counters is
recommended to be wide enough to not cause more than one overflow per sample
when sampled at a frequency of 1 Hz.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QOS_SW_GUIDE"><a class="anchor" href="#QOS_SW_GUIDE"></a>7. Software Guidelines</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="reporting-capacity-and-bandwidth-controllers"><a class="anchor" href="#reporting-capacity-and-bandwidth-controllers"></a>7.1. Reporting Capacity and Bandwidth Controllers</h3>
<div class="paragraph">
<p>The capability and bandwidth controllers that are present in the system should
be reported to operating systems using methods such as ACPI and/or device tree.
For each capacity and bandwidth controller, the following information should be
reported using these methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type of controller (for example, cache, interconnect, memory, and so on)</p>
</li>
<li>
<p>Location of the register programming interface for the controller</p>
</li>
<li>
<p>Placement and topology describing the hart and IO bridges that share the
resources controlled by the controller</p>
</li>
<li>
<p>The number of QoS identifiers supported by the controller</p>
</li>
<li>
<p>For memory bandwidth controllers, the controlled memory regions. These regions might
be described in the form of NUMA domains or proximity domains.</p>
</li>
<li>
<p>If a controller is part of a set of controllers that collectively control a
shared resource such as memory bandwidth of a memory region, then information
to identify all members of the set should be reported.</p>
</li>
<li>
<p>Constraints imposed by the controllers, such as the minimum number of capacity
or bandwidth blocks per RCID.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="context-switching-qos-identifiers"><a class="anchor" href="#context-switching-qos-identifiers"></a>7.2. Context Switching QoS Identifiers</h3>
<div class="paragraph">
<p>Typically, the contents of the <code>srmcfg</code> CSR are updated with a new <code>RCID</code>
and/or <code>MCID</code> by the HS/S-mode scheduler if the <code>RCID</code> and/or <code>MCID</code> of the
new workload (a process or a VM) is not same as that of the previous workload.</p>
</div>
<div class="paragraph">
<p>A context switch usually involves saving the context associated with the
workload being switched away from and restoring the context of the workload
being switched to. Such a context switch might be invoked in response to an explicit
call from the workload (for example, as a function of an <code>ECALL</code> invocation) or can be
done asynchronously (for example, in response to a timer interrupt). In such cases the
scheduler might want to execute with the <code>srmcfg</code> configuration of the
workload being switched away from such that this execution is attributed to the
workload being switched away from and then prior to restoring the new workloads
context, first switch to the <code>srmcfg</code> configuration appropriate for the
workload being switched to such that all of that execution is attributed to
the new workload. Further in this context switch process, if the scheduler
intends some of its execution to be attributed to neither the outgoing
workload nor the incoming workload, then the scheduler might switch to a new
<code>srmcfg</code> configuration that is different from that of either of the workloads
for the duration of such execution.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="qos-configurations-for-virtual-machines"><a class="anchor" href="#qos-configurations-for-virtual-machines"></a>7.3. QoS Configurations for Virtual Machines</h3>
<div class="paragraph">
<p>Usually for virtual machines the resource allocations are configured by the
hypervisor. Usually the Guest OS in a virtual machine does not participate in
the QoS flows as the Guest OS does not know the physical capabilities of the
platform or the resource allocations for other virtual machines in the system.</p>
</div>
<div class="paragraph">
<p>If a use case requires it, a hypervisor might virtualize the QoS capability to a
VM by virtualizing the memory-mapped CBQRI register interface and virtualizing
the virtual-instruction exception on access to <code>srmcfg</code> CSR by the Guest OS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the use of directly selecting among a set of <code>RCID</code> and/or <code>MCID</code> by a VM
becomes more prevalent and the overhead of virtualizing the <code>srmcfg</code> CSR using
the virtual instruction exception is not acceptable then a future extension can
be introduced where the <code>RCID</code>/<code>MCID</code> attempted to be written by VS mode are
used as a selector for a set of <code>RCID</code>/<code>MCID</code> that the hypervisor configures in
a set of HS mode CSRs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="qos-identifiers-for-supervisor-and-machine-mode"><a class="anchor" href="#qos-identifiers-for-supervisor-and-machine-mode"></a>7.4. QoS Identifiers for Supervisor and Machine Mode</h3>
<div class="paragraph">
<p>The <code>RCID</code> and <code>MCID</code> configured in <code>srmcfg</code> also apply to execution in
S/HS-mode, but this is typically not an issue. Usually, S/HS-mode execution
occurs to provide services, such as through an ABI, to software executing at
lower privilege. Because the S/HS-mode invocation provides a service for
the lower privilege mode, the S/HS-mode software might not opt to modify the
<code>srmcfg</code> CSR.</p>
</div>
<div class="paragraph">
<p>Similarly, The <code>RCID</code> and <code>MCID</code> configured in <code>srmcfg</code> also apply to execution
in M-mode, but this is typically not an issue either. Usually, M-mode execution
occurs to provide services, such as through the SBI interface, to software
executing at lower privilege. Because the M-mode invocation provides a
service for the lower privilege mode, the M-mode software might not opt to modify
the <code>srmcfg</code> CSR.</p>
</div>
<div class="paragraph">
<p>If separate <code>RCID</code> and/or <code>MCID</code> are needed during software execution in
M/S/HS-mode, then the M/S/HS-mode software might update the <code>srmcfg</code> CSR and
restore it before returning to lower privilege mode execution. The statistical
nature of QoS capabilities means that the brief duration, such as the few
instructions in the M/S/HS-mode trap handler entry point, during which the trap
handler might execute with the <code>RCID</code> and/or <code>MCID</code> established for lower
privilege mode operation might not have a significant statistical impact.
Unresolved include directive in modules/ROOT/pages/qos_header.adoc - include::qos_biblio.adoc[]</p>
</div>
</div>
</div>
</div>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../aia/v1.0/index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../aia/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../iommuArch/v1.0/index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../iommuArch/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
